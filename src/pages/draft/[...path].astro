---
/**
 * FlashDraft - Dynamic Draft Routes
 * 
 * Handles:
 * - /draft -> Current draft or overview
 * - /draft/[draftId] -> Specific draft
 * - /draft/[draftId]/[round]p[pick] -> Specific position in draft
 */

import Layout from '../../layouts/Layout.astro';
import DraftRouter from '../../frontend/components/DraftRouter';

export const prerender = false;

const { path } = Astro.params;
const searchParams = Astro.url.searchParams;

// Parse the path to determine what to show
let routeType = 'overview';
let draftId = null;
let round = null;
let pick = null;

if (path) {
  const segments = Array.isArray(path) ? path : [path];
  
  if (segments.length >= 1) {
    draftId = segments[0];
    routeType = 'draft';
    
    if (segments.length >= 2) {
      // Parse p1p3 format (pack 1 pick 3)
      const positionMatch = segments[1].match(/^p?(\d+)p(\d+)$/);
      if (positionMatch) {
        round = parseInt(positionMatch[1]);
        pick = parseInt(positionMatch[2]);
        routeType = 'position';
      }
    }
  }
}

// If no path or invalid draftId, show overview
if (!path || (path.length === 0)) {
  routeType = 'overview';
}
---

<Layout title={`FlashDraft - ${routeType === 'overview' ? 'Draft Overview' : 'Draft'}`}>
  <main>
    <div id="draft-app-root">
      <DraftRouter
        client:visible
        routeType={routeType}
        draftId={draftId}
        round={round}
        pick={pick}
      />
    </div>
  </main>
</Layout>