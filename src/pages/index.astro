---
import Layout from '../layouts/Layout.astro';
import { DraftEngine } from '../lib/engine/DraftEngine';
import { LocalStorageAdapter } from '../lib/engine/storage/LocalStorageAdapter';

// Function to create and start a new draft
const createDraft = (setCode: string) => {
  const engine = new DraftEngine(new LocalStorageAdapter());
  const draft = engine.createDraft(setCode, 8);
  return draft.draftId;
};
---

<Layout title="FlashDraft - Start Drafting">
  <main class="min-h-screen flex items-center justify-center p-6">
    <div class="max-w-4xl w-full">
      <!-- Logo/Title -->
      <div class="text-center mb-12">
        <h1 class="text-5xl font-bold text-white mb-4">FlashDraft</h1>
        <p class="text-xl text-slate-300">Choose your draft format</p>
      </div>


      <!-- Draft Selection Grid -->
      <div class="grid md:grid-cols-2 gap-8">
        <!-- Final Fantasy Draft -->
        <a 
          href="/draft/new?set=FIN"
          class="group relative overflow-hidden rounded-3xl bg-gradient-to-br from-purple-600/20 to-blue-600/20 backdrop-blur-sm border border-purple-500/30 hover:border-purple-400/50 transition-all duration-300 hover:scale-105 hover:shadow-2xl hover:shadow-purple-500/20 min-h-[200px]"
        >
          <div class="relative p-8 lg:p-12 h-full flex flex-col justify-between">
            <!-- Fanned out cards (positioned absolutely behind content) -->
            <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
              <div class="fin-cards relative" style="width: 120px; height: 32px;">
                <!-- Tifa Card (left) -->
                <div class="card-fan absolute bottom-0 left-1/2 -translate-x-1/2 w-24 h-32 transition-all duration-300 opacity-80">
                  <img 
                    src="https://cards.scryfall.io/normal/front/f/b/fb781323-2746-405d-a9b2-e778c037a6e9.jpg?1748706535" 
                    alt="Tifa Lockhart"
                    class="w-full h-full object-cover rounded-lg shadow-xl"
                  />
                </div>
                <!-- Vivi Card (center) -->
                <div class="card-fan absolute bottom-0 left-1/2 -translate-x-1/2 w-24 h-32 z-10 transition-all duration-300 opacity-80">
                  <img 
                    src="https://cards.scryfall.io/normal/front/e/c/ecc1027a-8c07-44a0-bdde-fa2844cff694.jpg?1748706721" 
                    alt="Vivi Ornitier"
                    class="w-full h-full object-cover rounded-lg shadow-xl"
                  />
                </div>
                <!-- Sephiroth Card (right) -->
                <div class="card-fan absolute bottom-0 left-1/2 -translate-x-1/2 w-24 h-32 transition-all duration-300 opacity-80">
                  <img 
                    src="https://cards.scryfall.io/normal/front/8/5/85eaf5e7-77dc-4842-a70c-ce4ac7f724df.jpg?1748707811" 
                    alt="Sephiroth"
                    class="w-full h-full object-cover rounded-lg shadow-xl"
                  />
                </div>
              </div>
            </div>

            <!-- Content (above cards) -->
            <div class="relative z-20 text-center mt-auto">
              <div class="bg-black/50 backdrop-blur-sm rounded-full px-6 py-3 mx-auto inline-flex items-center gap-3">
                <span class="text-purple-300 text-sm">FIN</span>
                <h2 class="text-xl font-bold text-white">Final Fantasy</h2>
                <span class="text-white">→</span>
              </div>
            </div>
          </div>
          
          <!-- Decorative gradient -->
          <div class="absolute inset-0 bg-gradient-to-br from-purple-600/0 via-purple-600/0 to-purple-600/20 opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none"></div>
        </a>

        <!-- Tarkir: Dragonstorm Draft -->
        <a 
          href="/draft/new?set=TDM"
          class="group relative overflow-hidden rounded-3xl bg-gradient-to-br from-red-600/20 to-orange-600/20 backdrop-blur-sm border border-red-500/30 hover:border-red-400/50 transition-all duration-300 hover:scale-105 hover:shadow-2xl hover:shadow-red-500/20 min-h-[200px]"
        >
          <div class="relative p-8 lg:p-12 h-full flex flex-col justify-between">
            <!-- Fanned out cards (positioned absolutely behind content) -->
            <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
              <div class="tdm-cards relative" style="width: 120px; height: 32px;">
                <!-- Ugin Card (left) -->
                <div class="card-fan absolute bottom-0 left-1/2 -translate-x-1/2 w-24 h-32 transition-all duration-300 opacity-80">
                  <img 
                    src="https://cards.scryfall.io/normal/front/6/4/64a5d494-efa1-446b-bebe-2ad36e154376.jpg?1744102946" 
                    alt="Ugin, Eye of the Storms"
                    class="w-full h-full object-cover rounded-lg shadow-xl"
                  />
                </div>
                <!-- Sarkhan Card (center) -->
                <div class="card-fan absolute bottom-0 left-1/2 -translate-x-1/2 w-24 h-32 z-10 transition-all duration-300 opacity-80">
                  <img 
                    src="https://cards.scryfall.io/normal/front/c/2/c2200646-7b7c-489d-bbae-16b03e1d7fb2.jpg?1743204437" 
                    alt="Sarkhan, Dragon Ascendant"
                    class="w-full h-full object-cover rounded-lg shadow-xl"
                  />
                </div>
                <!-- Breaching Dragonstorm (right) -->
                <div class="card-fan absolute bottom-0 left-1/2 -translate-x-1/2 w-24 h-32 transition-all duration-300 opacity-80">
                  <img 
                    src="https://cards.scryfall.io/normal/front/e/2/e2c2a069-7553-4879-abfb-b2aa3349e4b8.jpg?1743204368" 
                    alt="Breaching Dragonstorm"
                    class="w-full h-full object-cover rounded-lg shadow-xl"
                  />
                </div>
              </div>
            </div>

            <!-- Content (above cards) -->
            <div class="relative z-20 text-center mt-auto">
              <div class="bg-black/50 backdrop-blur-sm rounded-full px-6 py-3 mx-auto inline-flex items-center gap-3">
                <span class="text-red-300 text-sm">TDM</span>
                <h2 class="text-xl font-bold text-white">Tarkir: Dragonstorm</h2>
                <span class="text-white">→</span>
              </div>
            </div>
          </div>
          
          <!-- Decorative gradient -->
          <div class="absolute inset-0 bg-gradient-to-br from-red-600/0 via-red-600/0 to-red-600/20 opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none"></div>
        </a>
      </div>

      <!-- Secondary Actions -->
      <div class="mt-12 text-center">
        <a 
          href="/draft" 
          class="text-slate-400 hover:text-white transition-colors"
        >
          View saved drafts →
        </a>
      </div>
    </div>
  </main>

  <style>
    /* Card fan positioning */
    .card-fan {
      transform-origin: bottom center;
    }

    /* Default fan positions */
    .fin-cards .card-fan:nth-child(1),
    .tdm-cards .card-fan:nth-child(1) {
      transform: rotate(-15deg) translateX(-30px);
    }

    .fin-cards .card-fan:nth-child(2),
    .tdm-cards .card-fan:nth-child(2) {
      transform: rotate(0deg) translateX(0);
    }

    .fin-cards .card-fan:nth-child(3),
    .tdm-cards .card-fan:nth-child(3) {
      transform: rotate(15deg) translateX(30px);
    }

    /* Group hover effect - cards flare up slightly */
    .group:hover .card-fan {
      transform: rotate(var(--rotate)) translateX(var(--translate-x)) translateY(-8px) scale(1.05);
      filter: brightness(1.1);
    }

    .group:hover .fin-cards .card-fan:nth-child(1),
    .group:hover .tdm-cards .card-fan:nth-child(1) {
      --rotate: -18deg;
      --translate-x: -35px;
    }

    .group:hover .fin-cards .card-fan:nth-child(2),
    .group:hover .tdm-cards .card-fan:nth-child(2) {
      --rotate: 0deg;
      --translate-x: 0;
    }

    .group:hover .fin-cards .card-fan:nth-child(3),
    .group:hover .tdm-cards .card-fan:nth-child(3) {
      --rotate: 18deg;
      --translate-x: 35px;
    }

    /* Custom slider styles */
    input[type="range"]::-webkit-slider-thumb {
      appearance: none;
      width: 16px;
      height: 16px;
      background: white;
      cursor: pointer;
      border-radius: 50%;
    }

    input[type="range"]::-moz-range-thumb {
      width: 16px;
      height: 16px;
      background: white;
      cursor: pointer;
      border-radius: 50%;
      border: none;
    }
  </style>

  <script>
    // Fixed fan positioning based on finalized parameters
    const finCards = document.querySelectorAll('.fin-cards .card-fan') as NodeListOf<HTMLElement>;
    const tdmCards = document.querySelectorAll('.tdm-cards .card-fan') as NodeListOf<HTMLElement>;
    const finContainer = document.querySelector('.fin-cards') as HTMLElement;
    const tdmContainer = document.querySelector('.tdm-cards') as HTMLElement;

    // Apply fixed positioning with radius: 70px, h-offset: -50px, v-pos: 37px
    const radius = 70;
    const horizontalOffset = -50;
    const verticalOffset = 37;
    const angleStep = 30; // 30 degrees between cards
    
    // Update container position
    if (finContainer) {
      finContainer.style.transform = `translate(${horizontalOffset}px, ${verticalOffset}px)`;
    }
    if (tdmContainer) {
      tdmContainer.style.transform = `translate(${horizontalOffset}px, ${verticalOffset}px)`;
    }
    
    // Update FIN cards
    finCards.forEach((card, index) => {
      const angle = -angleStep + (index * angleStep);
      const translateX = Math.sin(angle * Math.PI / 180) * radius;
      const rotate = angle;
      
      card.style.setProperty('--rotate', `${rotate}deg`);
      card.style.setProperty('--translate-x', `${translateX}px`);
      card.style.transform = `rotate(${rotate}deg) translateX(${translateX}px)`;
    });

    // Update TDM cards
    tdmCards.forEach((card, index) => {
      const angle = -angleStep + (index * angleStep);
      const translateX = Math.sin(angle * Math.PI / 180) * radius;
      const rotate = angle;
      
      card.style.setProperty('--rotate', `${rotate}deg`);
      card.style.setProperty('--translate-x', `${translateX}px`);
      card.style.transform = `rotate(${rotate}deg) translateX(${translateX}px)`;
    });
  </script>
</Layout>